/* =========================================================
 * scrollreveal.min.js — 경량 로더 래퍼 (벤더 대체 아님)
 * - 조건 충족 시에만 CDN에서 ScrollReveal 로드
 * - 불가 시에는 폴백으로 data-sr 요소에 즉시 visible 처리
 * =======================================================*/
(function(){
  var prefersReduce = false;
  try {
    prefersReduce = window.matchMedia && window.matchMedia("(prefers-reduced-motion: reduce)").matches;
  } catch(e){}
  var isMobile = /Mobi|Android|iPhone|iPad|iPod/i.test(navigator.userAgent);

  // 로딩 조건: 데스크톱 + 모션 허용 + 교차관찰 가능
  var shouldLoad = !prefersReduce && !isMobile;

  function fallbackReveal(){
    // 폴백: 라이브러리 없이도 콘텐츠는 즉시 보이게
    var nodes = document.querySelectorAll("[data-sr]");
    for (var i = 0; i < nodes.length; i++) nodes[i].classList.add("is-visible");
  }

  function initSR(){
    if (typeof window.ScrollReveal !== "function") { fallbackReveal(); return; }
    try {
      var sr = window.ScrollReveal({ reset: false, distance: "16px", duration: 500, easing: "ease-out" });
      // 필요 섹션만 선택적으로
      sr.reveal("[data-sr='fade-up']",   { origin: "bottom", viewFactor: 0.15, interval: 80 });
      sr.reveal("[data-sr='fade-right']", { origin: "left",   viewFactor: 0.15, interval: 80 });
      sr.reveal("[data-sr='fade-left']",  { origin: "right",  viewFactor: 0.15, interval: 80 });
      // 한 번만 보이도록
      document.documentElement.classList.add("sr-initialized-once");
    } catch(e){
      fallbackReveal();
    }
  }

  function loadFromCDN(cb){
    var s = document.createElement("script");
    // jsDelivr 예시 (Netlify 대역폭 대신 CDN 사용)
    s.src = "https://cdn.jsdelivr.net/npm/scrollreveal@4.0.9/dist/scrollreveal.min.js";
    s.async = true; s.defer = true; s.crossOrigin = "anonymous";
    s.onload = cb;
    s.onerror = fallbackReveal;
    document.head.appendChild(s);
  }

  function boot(){
    if (!shouldLoad) { fallbackReveal(); return; }
    if (window.ScrollReveal) { initSR(); return; }
    loadFromCDN(initSR);
  }

  if (document.readyState === "complete" || document.readyState === "interactive") {
    setTimeout(boot, 0);
  } else {
    document.addEventListener("DOMContentLoaded", boot, { once: true });
  }
})();
